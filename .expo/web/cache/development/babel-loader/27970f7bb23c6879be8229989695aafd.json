{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\front-end-react-native-mobilapp\\\\components\\\\chat\\\\ChatApp.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { GiftedChat } from 'react-native-gifted-chat';\nimport AsyncStorage from '@react-native-community/async-storage';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport View from \"react-native-web/dist/exports/View\";\nimport YellowBox from \"react-native-web/dist/exports/YellowBox\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport firebase from 'firebase/app';\nimport 'firebase/firestore';\nvar firebaseConfig = {\n  apiKey: \"AIzaSyBy_E4K8UYuBxeKHagieRgmLIaKsOGGdfA\",\n  authDomain: \"chat-app-4e1ed.firebaseapp.com\",\n  projectId: \"chat-app-4e1ed\",\n  storageBucket: \"chat-app-4e1ed.appspot.com\",\n  messagingSenderId: \"1081745367221\",\n  appId: \"1:1081745367221:web:c026781c5090e4e5139efc\",\n  measurementId: \"G-H1BSSFBPMZ\"\n};\nfirebase.initializeApp(firebaseConfig);\nvar db = firebase.firestore();\nvar chatsRef = db.collection('chats');\nexport default function ChatApp() {\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      name = _useState4[0],\n      setName = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      messages = _useState6[0],\n      setMessages = _useState6[1];\n\n  useEffect(function () {\n    readUser();\n    var unsubscribe = chatsRef.onSnapshot(function (querySnapshot) {\n      var messagesFirestore = querySnapshot.docChanges().filter(function (_ref) {\n        var type = _ref.type;\n        return type === 'added';\n      }).map(function (_ref2) {\n        var doc = _ref2.doc;\n        var message = doc.data();\n        return _objectSpread(_objectSpread({}, message), {}, {\n          createdAt: message.createdAt.toDate()\n        });\n      }).sort(function (a, b) {\n        return b.createdAt.getTime() - a.createdAt.getTime();\n      });\n      appendMessages(messagesFirestore);\n    });\n    return function () {\n      return unsubscribe();\n    };\n  }, []);\n  var appendMessages = useCallback(function (messages) {\n    setMessages(function (previousMessages) {\n      return GiftedChat.append(previousMessages, messages);\n    });\n  }, [messages]);\n\n  function readUser() {\n    var user;\n    return _regeneratorRuntime.async(function readUser$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem('user'));\n\n          case 2:\n            user = _context.sent;\n            console.log(user);\n\n            if (user) {\n              setUser(JSON.parse(user));\n            }\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function handlePress() {\n    var _id, user;\n\n    return _regeneratorRuntime.async(function handlePress$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _id = Math.random().toString(36).substring(7);\n            user = {\n              _id: _id,\n              name: name\n            };\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem('user', JSON.stringify(user)));\n\n          case 4:\n            setUser(user);\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function handleSend(messages) {\n    var writes;\n    return _regeneratorRuntime.async(function handleSend$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            writes = messages.map(function (m) {\n              return chatsRef.add(m);\n            });\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(Promise.all(writes));\n\n          case 3:\n            AsyncStorage.clear();\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  if (!user) {\n    return React.createElement(View, {\n      style: styles.container,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 13\n      }\n    }, React.createElement(TextInput, {\n      style: styles.input,\n      placeholder: \"Enter your name\",\n      value: name,\n      onChangeText: setName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 17\n      }\n    }), React.createElement(Button, {\n      onPress: handlePress,\n      title: \"Enter the chat\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 17\n      }\n    }));\n  }\n\n  return React.createElement(GiftedChat, {\n    messages: messages,\n    user: user,\n    onSend: handleSend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 12\n    }\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center',\n    padding: 30\n  },\n  input: {\n    height: 50,\n    width: '100%',\n    borderWidth: 1,\n    padding: 15,\n    marginBottom: 20,\n    borderColor: 'gray'\n  }\n});","map":{"version":3,"sources":["C:/Users/User/Desktop/front-end-react-native-mobilapp/components/chat/ChatApp.js"],"names":["React","useState","useEffect","useCallback","GiftedChat","AsyncStorage","firebase","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","db","firestore","chatsRef","collection","ChatApp","user","setUser","name","setName","messages","setMessages","readUser","unsubscribe","onSnapshot","querySnapshot","messagesFirestore","docChanges","filter","type","map","doc","message","data","createdAt","toDate","sort","a","b","getTime","appendMessages","previousMessages","append","getItem","console","log","JSON","parse","handlePress","_id","Math","random","toString","substring","setItem","stringify","handleSend","writes","m","add","Promise","all","clear","styles","container","input","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent","padding","height","width","borderWidth","marginBottom","borderColor"],"mappings":"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","sourcesContent":["// @refresh reset\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react'\r\n// the user will be save in the local storege   so wwe will use use state \r\n// use effect hook  to render the copmponent \r\nimport { GiftedChat } from 'react-native-gifted-chat'\r\nimport AsyncStorage from '@react-native-community/async-storage'\r\n// \r\nimport { StyleSheet, TextInput, View, YellowBox, Button } from 'react-native'\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore'      \r\n\r\n\r\nconst firebaseConfig = {\r\n        apiKey: \"AIzaSyBy_E4K8UYuBxeKHagieRgmLIaKsOGGdfA\",\r\n        authDomain: \"chat-app-4e1ed.firebaseapp.com\",\r\n        projectId: \"chat-app-4e1ed\",\r\n        storageBucket: \"chat-app-4e1ed.appspot.com\",\r\n        messagingSenderId: \"1081745367221\",\r\n        appId: \"1:1081745367221:web:c026781c5090e4e5139efc\",\r\n        measurementId: \"G-H1BSSFBPMZ\"\r\n      };\r\n\r\n// Initialize Firebase\r\n\r\n    firebase.initializeApp(firebaseConfig);\r\n\r\n\r\n// YellowBox.ignoreWarnings(['Setting a timer for a long period of time'])\r\n\r\nconst db = firebase.firestore()\r\nconst chatsRef = db.collection('chats')\r\n\r\nexport default function ChatApp() {\r\n    const [user, setUser] = useState(null)    // cuse we dont have a user at the  bignning\r\n    const [name, setName] = useState('')\r\n    const [messages, setMessages] = useState([])\r\n\r\n    useEffect(() => {\r\n        readUser()\r\n        const unsubscribe = chatsRef.onSnapshot((querySnapshot) => {\r\n            const messagesFirestore = querySnapshot\r\n                .docChanges()\r\n                .filter(({ type }) => type === 'added')\r\n                .map(({ doc }) => {\r\n                    const message = doc.data()\r\n                    //createdAt is firebase.firestore.Timestamp instance\r\n                    //https://firebase.google.com/docs/reference/js/firebase.firestore.Timestamp\r\n                    return { ...message, createdAt: message.createdAt.toDate() }\r\n                })\r\n                .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())\r\n            appendMessages(messagesFirestore)\r\n        })\r\n        return () => unsubscribe()\r\n    }, [])\r\n\r\n    const appendMessages = useCallback(\r\n        (messages) => {\r\n            setMessages((previousMessages) => GiftedChat.append(previousMessages, messages))\r\n        },\r\n        [messages]\r\n    )\r\n  // async storege it will look if you have a user \r\n    async function readUser() {\r\n        const user = await AsyncStorage.getItem('user')\r\n        console.log (user)     \r\n        // here he will read the id and the user name but i dont know from where \r\n        if (user) {\r\n            setUser(JSON.parse(user))\r\n        }\r\n    }\r\n    async function handlePress() {\r\n        const _id = Math.random().toString(36).substring(7)\r\n        const user = { _id, name }\r\n        await AsyncStorage.setItem('user', JSON.stringify(user))\r\n        setUser(user)\r\n    }\r\n    async function handleSend(messages) {\r\n        const writes = messages.map((m) => chatsRef.add(m))\r\n        await Promise.all(writes)\r\n        AsyncStorage.clear()\r\n    }\r\n\r\n    if (!user) {\r\n        return (\r\n            <View style={styles.container}>\r\n                <TextInput style={styles.input} placeholder=\"Enter your name\" value={name} onChangeText={setName} />\r\n                <Button onPress={handlePress} title=\"Enter the chat\" />\r\n            </View>\r\n        )\r\n    }\r\n    return <GiftedChat messages={messages} user={user} onSend={handleSend} />\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: '#fff',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        padding: 30,\r\n    },\r\n    input: {\r\n        height: 50,\r\n        width: '100%',\r\n        borderWidth: 1,\r\n        padding: 15,\r\n        marginBottom: 20,\r\n        borderColor: 'gray',\r\n    },\r\n})\r\n\r\n\r\n\r\n\r\n\r\n// AsyncStorage.clear()"]},"metadata":{},"sourceType":"module"}